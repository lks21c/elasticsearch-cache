package com.elasticsearchcache;

import com.elasticsearchcache.service.ParsingService;
import org.elasticsearch.index.query.QueryBuilder;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.io.IOException;

@RunWith(SpringRunner.class)
@SpringBootTest
public class ParsingServiceTest {

    @Autowired
    ParsingService parsingService;

    @Test
    public void name() throws IOException {
        String q = "{\n" +
                "    \"bool\" : {\n" +
                "      \"must\" : [\n" +
                "        {\n" +
                "          \"query_string\" : {\n" +
                "            \"query\" : \"_exists_:poc_nm AND ( poc_code:AS40 OR poc_code:IS40 )\",\n" +
                "            \"fields\" : [ ],\n" +
                "            \"use_dis_max\" : true,\n" +
                "            \"tie_breaker\" : 0.0,\n" +
                "            \"default_operator\" : \"or\",\n" +
                "            \"auto_generate_phrase_queries\" : false,\n" +
                "            \"max_determinized_states\" : 10000,\n" +
                "            \"enable_position_increments\" : true,\n" +
                "            \"fuzziness\" : \"AUTO\",\n" +
                "            \"fuzzy_prefix_length\" : 0,\n" +
                "            \"fuzzy_max_expansions\" : 50,\n" +
                "            \"phrase_slop\" : 0,\n" +
                "            \"escape\" : false,\n" +
                "            \"split_on_whitespace\" : true,\n" +
                "            \"boost\" : 1.0\n" +
                "          }\n" +
                "        },\n" +
                "        {\n" +
                "          \"range\" : {\n" +
                "            \"ts\" : {\n" +
                "              \"from\" : \"2017-01-01T00:00:00\",\n" +
                "              \"to\" : \"2018-01-01T00:00:00\",\n" +
                "              \"include_lower\" : true,\n" +
                "              \"include_upper\" : false,\n" +
                "              \"time_zone\" : \"+09:00\",\n" +
                "              \"boost\" : 1.0\n" +
                "            }\n" +
                "          }\n" +
                "        }\n" +
                "      ],\n" +
                "      \"disable_coord\" : false,\n" +
                "      \"adjust_pure_negative\" : true,\n" +
                "      \"boost\" : 1.0\n" +
                "    }\n" +
                "  }";

        QueryBuilder qb = parsingService.parseQuery(q);

        System.out.println("name = " + qb.getName());
    }

    @Test
    public void testGenerateTermsRes() {
        String resBody = "{\n" +
                "      \"took\": 3,\n" +
                "      \"timed_out\": false,\n" +
                "      \"_shards\": {\n" +
                "        \"total\": 55,\n" +
                "        \"successful\": 55,\n" +
                "        \"failed\": 0\n" +
                "      },\n" +
                "      \"hits\": {\n" +
                "        \"total\": 2718971,\n" +
                "        \"max_score\": 0,\n" +
                "        \"hits\": []\n" +
                "      },\n" +
                "      \"aggregations\": {\n" +
                "        \"2\": {\n" +
                "          \"buckets\": \n" +
                "[{\"key_as_string\":\"2018-01-12T00:00:00.000Z\",\"doc_count\":1.7340322E7,\"3\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9663386.0},{\"key\":\"iPhone App\",\"doc_count\":7331569.0},{\"key\":\"iPad App\",\"doc_count\":177331.0},{\"key\":\"Macintosh PC Player\",\"doc_count\":47057.0},{\"key\":\"Android Phone Melon with kakao\",\"doc_count\":39354.0},{\"key\":\"iPhone Web\",\"doc_count\":29318.0},{\"key\":\"iPhone Melon with kakao\",\"doc_count\":27332.0},{\"key\":\"Android Phone Web\",\"doc_count\":24579.0},{\"key\":\"미러링크 현대차OEM\",\"doc_count\":279.0},{\"key\":\"Android AZTalk Phone Web\",\"doc_count\":57.0},{\"key\":\"iPhone AZTalk Web\",\"doc_count\":42.0},{\"key\":\"Windows PC AZTalk Web\",\"doc_count\":7.0},{\"key\":\"Mobile AZTalk Web (Etc)\",\"doc_count\":3.0},{\"key\":\"PC AZTalk Web (Etc)\",\"doc_count\":2.0}]},\"key\":1.5157152E12},{\"key_as_string\":\"2018-01-13T00:00:00.000Z\",\"doc_count\":1.721735E7,\"3\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9599165.0},{\"key\":\"iPhone App\",\"doc_count\":7267922.0},{\"key\":\"iPad App\",\"doc_count\":176713.0},{\"key\":\"Macintosh PC Player\",\"doc_count\":48385.0},{\"key\":\"Android Phone Melon with kakao\",\"doc_count\":41142.0},{\"key\":\"iPhone Web\",\"doc_count\":29795.0},{\"key\":\"iPhone Melon with kakao\",\"doc_count\":28380.0},{\"key\":\"Android Phone Web\",\"doc_count\":25558.0},{\"key\":\"미러링크 현대차OEM\",\"doc_count\":208.0},{\"key\":\"Android AZTalk Phone Web\",\"doc_count\":44.0},{\"key\":\"iPhone AZTalk Web\",\"doc_count\":26.0},{\"key\":\"Windows PC AZTalk Web\",\"doc_count\":4.0},{\"key\":\"Mobile AZTalk Web (Etc)\",\"doc_count\":2.0},{\"key\":\"PC AZTalk Web (Etc)\",\"doc_count\":1.0}]},\"key\":1.5158016E12}]            \n" +
                "        }\n" +
                "      },\n" +
                "      \"status\": 200\n" +
                "    }\n" +
                "";
//        System.out.println("resBody = " + resBody);
        String newRes = parsingService.generateTermsRes(resBody);
        System.out.println("newRes = " + newRes);
    }

    @Test
    public void testGenerateTermsRes2() {
        String resBody = "{\n" +
                "      \"took\": 3,\n" +
                "      \"timed_out\": false,\n" +
                "      \"_shards\": {\n" +
                "        \"total\": 55,\n" +
                "        \"successful\": 55,\n" +
                "        \"failed\": 0\n" +
                "      },\n" +
                "      \"hits\": {\n" +
                "        \"total\": 2718971,\n" +
                "        \"max_score\": 0,\n" +
                "        \"hits\": []\n" +
                "      },\n" +
                "      \"aggregations\": {\n" +
                "        \"2\": {\n" +
                "          \"buckets\": \n" +
                "[{\"key_as_string\":\"2018-01-12T00:00:00.000Z\",\"doc_count\":1.7340322E7,\"3\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"3년전\",\"doc_count\":6452472.0,\"1\":{\"value\":4.7435609E7},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"00\",\"doc_count\":6452472.0,\"1\":{\"value\":4.7435609E7}}]}},{\"key\":\"2017\",\"doc_count\":5137319.0,\"1\":{\"value\":1.6193699E7},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":2716554.0,\"buckets\":[{\"key\":\"11\",\"doc_count\":508357.0,\"1\":{\"value\":1845081.0}},{\"key\":\"12\",\"doc_count\":501334.0,\"1\":{\"value\":1783883.0}},{\"key\":\"10\",\"doc_count\":440900.0,\"1\":{\"value\":1537100.0}},{\"key\":\"8\",\"doc_count\":489986.0,\"1\":{\"value\":1519766.0}},{\"key\":\"9\",\"doc_count\":480188.0,\"1\":{\"value\":1484035.0}}]}},{\"key\":\"2016\",\"doc_count\":3016342.0,\"1\":{\"value\":8676979.0},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":1356518.0,\"buckets\":[{\"key\":\"10\",\"doc_count\":419525.0,\"1\":{\"value\":1193923.0}},{\"key\":\"11\",\"doc_count\":370212.0,\"1\":{\"value\":1037045.0}},{\"key\":\"12\",\"doc_count\":359072.0,\"1\":{\"value\":1001625.0}},{\"key\":\"9\",\"doc_count\":297291.0,\"1\":{\"value\":825231.0}},{\"key\":\"5\",\"doc_count\":213724.0,\"1\":{\"value\":624597.0}}]}},{\"key\":\"2015\",\"doc_count\":2229852.0,\"1\":{\"value\":6546069.0},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":1209057.0,\"buckets\":[{\"key\":\"10\",\"doc_count\":226563.0,\"1\":{\"value\":684667.0}},{\"key\":\"11\",\"doc_count\":218653.0,\"1\":{\"value\":657157.0}},{\"key\":\"12\",\"doc_count\":197578.0,\"1\":{\"value\":586494.0}},{\"key\":\"9\",\"doc_count\":187274.0,\"1\":{\"value\":566827.0}},{\"key\":\"8\",\"doc_count\":190727.0,\"1\":{\"value\":563428.0}}]}},{\"key\":\"2018\",\"doc_count\":393202.0,\"1\":{\"value\":1511136.0},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"1\",\"doc_count\":393202.0,\"1\":{\"value\":1511136.0}}]}}]},\"key\":1.5157152E12},{\"key_as_string\":\"2018-01-13T00:00:00.000Z\",\"doc_count\":1.721735E7,\"3\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"3년전\",\"doc_count\":6403271.0,\"1\":{\"value\":4.6026538E7},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"00\",\"doc_count\":6403271.0,\"1\":{\"value\":4.6026538E7}}]}},{\"key\":\"2017\",\"doc_count\":5090765.0,\"1\":{\"value\":1.5847098E7},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":2712963.0,\"buckets\":[{\"key\":\"12\",\"doc_count\":494717.0,\"1\":{\"value\":1741035.0}},{\"key\":\"11\",\"doc_count\":493567.0,\"1\":{\"value\":1727363.0}},{\"key\":\"10\",\"doc_count\":434162.0,\"1\":{\"value\":1498411.0}},{\"key\":\"8\",\"doc_count\":482365.0,\"1\":{\"value\":1474426.0}},{\"key\":\"9\",\"doc_count\":472991.0,\"1\":{\"value\":1466195.0}}]}},{\"key\":\"2016\",\"doc_count\":2996003.0,\"1\":{\"value\":8499341.0},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":1342056.0,\"buckets\":[{\"key\":\"10\",\"doc_count\":417543.0,\"1\":{\"value\":1158344.0}},{\"key\":\"12\",\"doc_count\":357544.0,\"1\":{\"value\":1000509.0}},{\"key\":\"11\",\"doc_count\":365825.0,\"1\":{\"value\":1000342.0}},{\"key\":\"9\",\"doc_count\":297257.0,\"1\":{\"value\":816436.0}},{\"key\":\"5\",\"doc_count\":215778.0,\"1\":{\"value\":625658.0}}]}},{\"key\":\"2015\",\"doc_count\":2205324.0,\"1\":{\"value\":6410332.0},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":1190933.0,\"buckets\":[{\"key\":\"10\",\"doc_count\":226672.0,\"1\":{\"value\":683167.0}},{\"key\":\"11\",\"doc_count\":218029.0,\"1\":{\"value\":645222.0}},{\"key\":\"12\",\"doc_count\":196125.0,\"1\":{\"value\":571099.0}},{\"key\":\"9\",\"doc_count\":185945.0,\"1\":{\"value\":560427.0}},{\"key\":\"8\",\"doc_count\":187620.0,\"1\":{\"value\":555525.0}}]}},{\"key\":\"2018\",\"doc_count\":409460.0,\"1\":{\"value\":1562537.0},\"4\":{\"doc_count_error_upper_bound\":0.0,\"sum_other_doc_count\":0.0,\"buckets\":[{\"key\":\"1\",\"doc_count\":409460.0,\"1\":{\"value\":1562537.0}}]}}]},\"key\":1.5158016E12}]            \n" +
                "        }\n" +
                "      },\n" +
                "      \"status\": 200\n" +
                "    }";
        System.out.println("resBody = " + resBody);
        String newRes = parsingService.generateTermsRes(resBody);

        System.out.println("newRes = " + newRes);
    }

    @Test
    public void testGenerateTermsRes3() {
        String resBody = "{\"took\":2,\"timed_out\":false,\"_shards\":{\"total\":16,\"successful\":16,\"failed\":0},\"hits\":{\"total\":35544838,\"max_score\":0.0,\"hits\":[]},\"aggregations\":{\"dates\":{\"buckets\":[{\"key_as_string\":\"2018-01-14T00:00:00.000+09:00\",\"key\":1515855600000,\"doc_count\":17218871,\"3\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9600024},{\"key\":\"iPhone App\",\"doc_count\":7268542},{\"key\":\"iPad App\",\"doc_count\":176717},{\"key\":\"Macintosh PC Player\",\"doc_count\":48386},{\"key\":\"Android Phone Melon with kakao\",\"doc_count\":41153},{\"key\":\"iPhone Web\",\"doc_count\":29800},{\"key\":\"iPhone Melon with kakao\",\"doc_count\":28390},{\"key\":\"Android Phone Web\",\"doc_count\":25569},{\"key\":\"미러링크 현대차OEM\",\"doc_count\":208},{\"key\":\"Android AZTalk Phone Web\",\"doc_count\":44},{\"key\":\"iPhone AZTalk Web\",\"doc_count\":26},{\"key\":\"Windows PC AZTalk Web\",\"doc_count\":4},{\"key\":\"Mobile AZTalk Web (Etc)\",\"doc_count\":2},{\"key\":\"PC AZTalk Web (Etc)\",\"doc_count\":1}]}},{\"key_as_string\":\"2018-01-15T00:00:00.000+09:00\",\"key\":1515942000000,\"doc_count\":18325967,\"3\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9758827},{\"key\":\"iPhone App\",\"doc_count\":8200248},{\"key\":\"iPad App\",\"doc_count\":176042},{\"key\":\"Macintosh PC Player\",\"doc_count\":61350},{\"key\":\"Android Phone Melon with kakao\",\"doc_count\":39812},{\"key\":\"iPhone Web\",\"doc_count\":33062},{\"key\":\"Android Phone Web\",\"doc_count\":28335},{\"key\":\"iPhone Melon with kakao\",\"doc_count\":27867},{\"key\":\"미러링크 현대차OEM\",\"doc_count\":232},{\"key\":\"Android AZTalk Phone Web\",\"doc_count\":96},{\"key\":\"iPhone AZTalk Web\",\"doc_count\":49},{\"key\":\"Windows PC AZTalk Web\",\"doc_count\":29},{\"key\":\"Mobile AZTalk Web (Etc)\",\"doc_count\":5},{\"key\":\"PC AZTalk Web (Etc)\",\"doc_count\":3}]}}]}},\"status\":200}";
        System.out.println("resBody = " + resBody);
        String newRes = parsingService.generateTermsRes(resBody);
    }

    @Test
    public void test2() {
        String res = "{\"took\":79,\"timed_out\":false,\"num_reduce_phases\":2,\"_shards\":{\"total\":628,\"successful\":628,\"failed\":0},\"hits\":{\"total\":592256872,\"max_score\":0.0,\"hits\":[]},\"aggregations\":{\"date_histogram#dates\":{\"buckets\":[{\"key_as_string\":\"2017-11-26T00:00:00.000+09:00\",\"key\":1511622000000,\"doc_count\":1695,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":1016,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":1016,\"sum#sum\":{\"value\":1105.0}}]}},{\"key\":\"iPhone App\",\"doc_count\":679,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":679,\"sum#sum\":{\"value\":701.0}}]}}]}},{\"key_as_string\":\"2017-11-27T00:00:00.000+09:00\",\"key\":1511708400000,\"doc_count\":16806238,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9635997,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":9635997,\"sum#sum\":{\"value\":5.2006003E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7170241,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":7170241,\"sum#sum\":{\"value\":3.1365357E7}}]}}]}},{\"key_as_string\":\"2017-11-28T00:00:00.000+09:00\",\"key\":1511794800000,\"doc_count\":16958729,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9653587,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":9653587,\"sum#sum\":{\"value\":5.2112605E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7305142,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":7305142,\"sum#sum\":{\"value\":3.1857527E7}}]}}]}},{\"key_as_string\":\"2017-11-29T00:00:00.000+09:00\",\"key\":1511881200000,\"doc_count\":17315783,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9921927,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":9921927,\"sum#sum\":{\"value\":5.2928055E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7393856,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":7393856,\"sum#sum\":{\"value\":3.2089141E7}}]}}]}},{\"key_as_string\":\"2017-11-30T00:00:00.000+09:00\",\"key\":1511967600000,\"doc_count\":17128401,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9795780,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":9795780,\"sum#sum\":{\"value\":5.2613948E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7332621,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-11-01T00:00:00.000+09:00\",\"key\":1509462000000,\"doc_count\":7332621,\"sum#sum\":{\"value\":3.2171146E7}}]}}]}},{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":17110578,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9819110,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9819110,\"sum#sum\":{\"value\":5.3582726E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7291468,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7291468,\"sum#sum\":{\"value\":3.1907591E7}}]}}]}},{\"key_as_string\":\"2017-12-02T00:00:00.000+09:00\",\"key\":1512140400000,\"doc_count\":17969293,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":10497417,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":10497417,\"sum#sum\":{\"value\":6.1584398E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7471876,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7471876,\"sum#sum\":{\"value\":3.584742E7}}]}}]}},{\"key_as_string\":\"2017-12-03T00:00:00.000+09:00\",\"key\":1512226800000,\"doc_count\":16549082,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9527523,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9527523,\"sum#sum\":{\"value\":5.4907636E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7021559,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7021559,\"sum#sum\":{\"value\":3.2799443E7}}]}}]}},{\"key_as_string\":\"2017-12-04T00:00:00.000+09:00\",\"key\":1512313200000,\"doc_count\":17040254,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9655214,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9655214,\"sum#sum\":{\"value\":5.3647593E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7385040,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7385040,\"sum#sum\":{\"value\":3.3585197E7}}]}}]}},{\"key_as_string\":\"2017-12-05T00:00:00.000+09:00\",\"key\":1512399600000,\"doc_count\":17144975,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9704721,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9704721,\"sum#sum\":{\"value\":5.4054779E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7440254,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7440254,\"sum#sum\":{\"value\":3.3800376E7}}]}}]}},{\"key_as_string\":\"2017-12-06T00:00:00.000+09:00\",\"key\":1512486000000,\"doc_count\":17146790,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9798093,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9798093,\"sum#sum\":{\"value\":5.4905064E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7348697,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7348697,\"sum#sum\":{\"value\":3.3371888E7}}]}}]}},{\"key_as_string\":\"2017-12-07T00:00:00.000+09:00\",\"key\":1512572400000,\"doc_count\":17050619,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9720876,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9720876,\"sum#sum\":{\"value\":5.4195196E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7329743,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7329743,\"sum#sum\":{\"value\":3.3110875E7}}]}}]}},{\"key_as_string\":\"2017-12-08T00:00:00.000+09:00\",\"key\":1512658800000,\"doc_count\":17181517,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9819820,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9819820,\"sum#sum\":{\"value\":5.4952237E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7361697,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7361697,\"sum#sum\":{\"value\":3.321847E7}}]}}]}},{\"key_as_string\":\"2017-12-09T00:00:00.000+09:00\",\"key\":1512745200000,\"doc_count\":17017131,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9777048,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9777048,\"sum#sum\":{\"value\":5.7055799E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7240083,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7240083,\"sum#sum\":{\"value\":3.3746344E7}}]}}]}},{\"key_as_string\":\"2017-12-10T00:00:00.000+09:00\",\"key\":1512831600000,\"doc_count\":16255542,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9316690,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9316690,\"sum#sum\":{\"value\":5.4319346E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":6938852,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":6938852,\"sum#sum\":{\"value\":3.2844301E7}}]}}]}},{\"key_as_string\":\"2017-12-11T00:00:00.000+09:00\",\"key\":1512918000000,\"doc_count\":17018059,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9703301,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9703301,\"sum#sum\":{\"value\":5.485662E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7314758,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7314758,\"sum#sum\":{\"value\":3.3905843E7}}]}}]}},{\"key_as_string\":\"2017-12-12T00:00:00.000+09:00\",\"key\":1513004400000,\"doc_count\":17093276,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9710494,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9710494,\"sum#sum\":{\"value\":5.5704221E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7382782,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7382782,\"sum#sum\":{\"value\":3.4394164E7}}]}}]}},{\"key_as_string\":\"2017-12-13T00:00:00.000+09:00\",\"key\":1513090800000,\"doc_count\":17198999,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9804300,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9804300,\"sum#sum\":{\"value\":5.6230084E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7394699,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7394699,\"sum#sum\":{\"value\":3.440284E7}}]}}]}},{\"key_as_string\":\"2017-12-14T00:00:00.000+09:00\",\"key\":1513177200000,\"doc_count\":17120509,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9701595,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9701595,\"sum#sum\":{\"value\":5.5129431E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7418914,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7418914,\"sum#sum\":{\"value\":3.437934E7}}]}}]}},{\"key_as_string\":\"2017-12-15T00:00:00.000+09:00\",\"key\":1513263600000,\"doc_count\":17168730,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9801636,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9801636,\"sum#sum\":{\"value\":5.5130469E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7367094,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7367094,\"sum#sum\":{\"value\":3.3384354E7}}]}}]}},{\"key_as_string\":\"2017-12-16T00:00:00.000+09:00\",\"key\":1513350000000,\"doc_count\":16956758,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9709158,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9709158,\"sum#sum\":{\"value\":5.5949646E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7247600,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7247600,\"sum#sum\":{\"value\":3.3344335E7}}]}}]}},{\"key_as_string\":\"2017-12-17T00:00:00.000+09:00\",\"key\":1513436400000,\"doc_count\":16045325,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9175222,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9175222,\"sum#sum\":{\"value\":5.2889199E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":6870103,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":6870103,\"sum#sum\":{\"value\":3.1925302E7}}]}}]}},{\"key_as_string\":\"2017-12-18T00:00:00.000+09:00\",\"key\":1513522800000,\"doc_count\":16899088,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9532935,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9532935,\"sum#sum\":{\"value\":5.3122289E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7366153,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7366153,\"sum#sum\":{\"value\":3.3628628E7}}]}}]}},{\"key_as_string\":\"2017-12-19T00:00:00.000+09:00\",\"key\":1513609200000,\"doc_count\":18769685,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":10516692,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":10516692,\"sum#sum\":{\"value\":5.989081E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":8252993,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":8252993,\"sum#sum\":{\"value\":3.990981E7}}]}}]}},{\"key_as_string\":\"2017-12-20T00:00:00.000+09:00\",\"key\":1513695600000,\"doc_count\":17005006,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9609565,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9609565,\"sum#sum\":{\"value\":5.3175555E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7395441,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7395441,\"sum#sum\":{\"value\":3.3663085E7}}]}}]}},{\"key_as_string\":\"2017-12-21T00:00:00.000+09:00\",\"key\":1513782000000,\"doc_count\":16760054,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9444698,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9444698,\"sum#sum\":{\"value\":5.1956824E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7315356,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7315356,\"sum#sum\":{\"value\":3.2881891E7}}]}}]}},{\"key_as_string\":\"2017-12-22T00:00:00.000+09:00\",\"key\":1513868400000,\"doc_count\":16703308,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9477857,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9477857,\"sum#sum\":{\"value\":5.2485749E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7225451,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7225451,\"sum#sum\":{\"value\":3.2056306E7}}]}}]}},{\"key_as_string\":\"2017-12-23T00:00:00.000+09:00\",\"key\":1513954800000,\"doc_count\":16924798,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9709274,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9709274,\"sum#sum\":{\"value\":5.5601338E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7215524,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7215524,\"sum#sum\":{\"value\":3.2996083E7}}]}}]}},{\"key_as_string\":\"2017-12-24T00:00:00.000+09:00\",\"key\":1514041200000,\"doc_count\":16234426,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9198104,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9198104,\"sum#sum\":{\"value\":5.3038975E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7036322,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7036322,\"sum#sum\":{\"value\":3.28621E7}}]}}]}},{\"key_as_string\":\"2017-12-25T00:00:00.000+09:00\",\"key\":1514127600000,\"doc_count\":16094414,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9140837,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9140837,\"sum#sum\":{\"value\":5.1709632E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":6953577,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":6953577,\"sum#sum\":{\"value\":3.1662994E7}}]}}]}},{\"key_as_string\":\"2017-12-26T00:00:00.000+09:00\",\"key\":1514214000000,\"doc_count\":17437660,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":10045853,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":10045853,\"sum#sum\":{\"value\":5.7346591E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7391807,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7391807,\"sum#sum\":{\"value\":3.4724117E7}}]}}]}},{\"key_as_string\":\"2017-12-27T00:00:00.000+09:00\",\"key\":1514300400000,\"doc_count\":17035948,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9691121,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9691121,\"sum#sum\":{\"value\":5.5357676E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7344827,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7344827,\"sum#sum\":{\"value\":3.4028946E7}}]}}]}},{\"key_as_string\":\"2017-12-28T00:00:00.000+09:00\",\"key\":1514386800000,\"doc_count\":16502789,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9354952,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9354952,\"sum#sum\":{\"value\":5.218882E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7147837,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7147837,\"sum#sum\":{\"value\":3.2041203E7}}]}}]}},{\"key_as_string\":\"2017-12-29T00:00:00.000+09:00\",\"key\":1514473200000,\"doc_count\":16576036,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9416352,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9416352,\"sum#sum\":{\"value\":5.2774073E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7159684,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7159684,\"sum#sum\":{\"value\":3.1959929E7}}]}}]}},{\"key_as_string\":\"2017-12-30T00:00:00.000+09:00\",\"key\":1514559600000,\"doc_count\":16411057,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":9385230,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":9385230,\"sum#sum\":{\"value\":5.3672568E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":7025827,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":7025827,\"sum#sum\":{\"value\":3.2314328E7}}]}}]}},{\"key_as_string\":\"2017-12-31T00:00:00.000+09:00\",\"key\":1514646000000,\"doc_count\":15624320,\"sterms#term\":{\"doc_count_error_upper_bound\":0,\"sum_other_doc_count\":0,\"buckets\":[{\"key\":\"Android Phone App\",\"doc_count\":8922412,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":8922412,\"sum#sum\":{\"value\":5.0669631E7}}]}},{\"key\":\"iPhone App\",\"doc_count\":6701908,\"date_histogram#time\":{\"buckets\":[{\"key_as_string\":\"2017-12-01T00:00:00.000+09:00\",\"key\":1512054000000,\"doc_count\":6701908,\"sum#sum\":{\"value\":3.0157748E7}}]}}]}}]}}}";
        System.out.println("res = " + res);
        String resBody = parsingService.generateTermsRes(res);
        System.out.println("resBody = " + resBody);
    }
}
